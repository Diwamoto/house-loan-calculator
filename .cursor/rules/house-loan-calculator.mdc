---
description: 
globs: 
alwaysApply: true
---
# 住宅ローン計算機の仕様

## 基本計算

### 月々の返済額計算
- 計算式: PMT(金利/12, 返済月数, 借入額)
- 返済総額 = 月々の返済額 × 返済月数
- 利息総額 = 返済総額 - 借入額

### 税金計算
- 固定資産税 = 借入額 × 1.4%
- 都市計画税 = 借入額 × 0.2%（小山市の場合）

### 税制優遇措置
- 住宅ローン減税 = 借入額×0.7%×13年（上限20万円/年）
- 不動産取得税軽減 = 1200万円×3%
- 登録免許税軽減 = 借入額×1.7%

## 投資比較

### 賃貸物件の支出
- 月額賃料: 10万円
- 更新費用: 11万円
- 更新回数: 年数÷2（切り捨て）
- 合計金額 = (月額賃料 × 12ヶ月 × 年数) + (更新費用 × 更新回数)

### 4. NISA投資比較
- 投資額の計算
  - 月々の支払いが12万円未満の場合、差額を投資に回す
  - 投資額は5,000円単位で切り捨て
  - 例：月々の支払いが8万円の場合、4万円を投資に回す
  - 例：月々の支払いが12万円以上の場合、投資額は0円
- 投資リターン
  - 年利5%で複利計算
  - 投資額は毎年12ヶ月分を一括で投資
  - 前年の残高に5%のリターンを加算後、その年の投資額を追加
  - NISA口座を使用するため、税金は考慮しない
- 投資結果の表示
  - 累積投資額
  - 投資リターン（税引後）
  - 投資残高
  - 投資期間
  - 投資利回り（年率）

## 土地売却シミュレーション

### 売却価格
- 借入額の60%で売却

### 残債計算
- 残債 = 月々の返済額 × (1 - (1 + 月利)^(残り月数)) / 月利

### 利息削減
- 繰上げ返済による返済総額の削減分

### 売却益
- 売却益 = 売却金額 - 残債 + 住宅ローン減税 - 固定資産税累計

### 投資収益
- 毎月(10万円-返済額)を年利5%で運用（5000円単位で切り捨て）
- 複利計算: 前年の残高 × 1.05 + 年間の投資額
- 非課税（NISAのため税引きなし）

### 総合評価
- 売却益と投資収益の合計が賃貸支出を上回る年数を計算
- 賃貸支出 = (月額賃料 × 12ヶ月 × 年数) + (更新費用 × 更新回数)
- 更新回数 = 年数 ÷ 2（切り捨て）

### 5. 土地売却シミュレーション
- 売却価格の計算
  - 土地の購入価格を基準に、年率2%で上昇
  - 例：3,000万円の土地を10年後に売却する場合
    - 3,000万円 × (1 + 0.02)^10 = 約3,657万円
- 売却益の計算
  - 売却価格 - 土地購入価格
  - 例：3,657万円 - 3,000万円 = 657万円
- 投資リターンとの比較
  - 売却益と投資リターンを合算
  - 例：売却益657万円 + 投資リターン500万円 = 1,157万円
- 賃貸との比較
  - 売却益と投資リターンの合計を、賃貸の総支払額と比較
  - 例：賃貸の総支払額が1,200万円の場合
    - 1,157万円 - 1,200万円 = -43万円（賃貸の方が43万円得）
- 投資額の計算
  - 月々の支払いが12万円未満の場合、差額を投資に回す
  - 投資額は5,000円単位で切り捨て
  - 例：月々の支払いが8万円の場合、4万円を投資に回す
  - 例：月々の支払いが12万円以上の場合、投資額は0円

## 表示仕様

### 基本情報
- 借入額: 100万円〜5000万円（50万円単位）
- 返済期間: 30年または35年
- 金利: 0%〜3%（0.001%単位）
- 固定資産税: 0円〜50万円（1万円単位）

### 計算結果表示
- 返済情報（月々の返済額、返済総額、利息総額）
- 税金・諸経費（固定資産税、都市計画税、諸経費合計）
- 税制優遇措置（住宅ローン減税、不動産取得税軽減、登録免許税軽減）
- 投資比較（賃貸物件の合計金額、NISA投資の結果）
- 土地売却シミュレーション（売却金額、残債、売却益、投資収益）
- 35年間の金額推移表（残債、月々の返済額、投資額、投資収益など）

### 表示形式
- 金額: 日本円表示（カンマ区切り、小数点以下なし）
- 年数: 整数表示
- エラー表示: 赤字で表示
- 重要数値: 赤字太字で表示
